<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Knot & Cuddle</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #db7c7c; --secondary: #5d4037; --bg: #fff9f0; --white: #ffffff; }
        * { box-sizing: border-box; font-family: 'Nunito', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: var(--secondary); display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        .sidebar { width: 260px; background: var(--secondary); color: white; padding: 2rem; display: flex; flex-direction: column; gap: 1rem; }
        .brand { font-size: 1.5rem; font-weight: 900; margin-bottom: 2rem; color: var(--primary); }
        .menu-item { padding: 12px; cursor: pointer; border-radius: 10px; transition: 0.3s; display: flex; align-items: center; gap: 10px; font-weight: bold;}
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.1); color: var(--primary); }
        .menu-item i { width: 20px; text-align: center; }

        /* Main Content */
        .main { flex: 1; padding: 2rem; overflow-y: auto; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Forms & Cards */
        .card { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 2rem; border-top: 5px solid var(--primary); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .full-width { grid-column: span 2; }
        
        h2 { margin-bottom: 1.5rem; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        label { font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; display: block; }
        input, textarea, button { padding: 12px; border-radius: 8px; border: 1px solid #ddd; width: 100%; outline: none; font-size: 1rem; }
        textarea { resize: vertical; }
        input:focus, textarea:focus { border-color: var(--primary); }
        
        button { background: var(--primary); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { background: #b95d5d; transform: translateY(-2px); }
        .btn-cancel { background: #95a5a6; }
        .btn-cancel:hover { background: #7f8c8d; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th { background: #f8f9fa; color: var(--secondary); font-weight: 800; }
        th, td { text-align: left; padding: 15px; border-bottom: 1px solid #eee; font-size: 0.95rem; }
        .prod-img-preview { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd; }
        
        /* Action Buttons */
        .actions { display: flex; gap: 5px; }
        .btn-edit { background: #f39c12; padding: 5px 10px; font-size: 0.8rem; width: auto; color: white; border-radius: 5px; cursor: pointer; }
        .btn-delete { background: #e74c3c; padding: 5px 10px; font-size: 0.8rem; width: auto; color: white; border-radius: 5px; cursor: pointer; }

        /* FAQ Specific */
        .faq-list-item { background: #fff; padding: 15px; border: 1px solid #eee; margin-bottom: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: flex-start; }
        .faq-content h4 { color: var(--primary); margin-bottom: 5px; }
        .faq-content p { font-size: 0.9rem; color: #666; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand">Admin Panel</div>
        <div class="menu-item active" onclick="showSection('products')"><i class="fas fa-box"></i> Products</div>
        <div class="menu-item" onclick="showSection('faqs')"><i class="fas fa-question-circle"></i> Manage FAQs</div>
        <div class="menu-item" onclick="showSection('messages')"><i class="fas fa-envelope"></i> Messages</div>
        <div class="menu-item" onclick="window.location.href='index.html'"><i class="fas fa-external-link-alt"></i> View Website</div>
    </div>

    <div class="main">
        
        <div id="products" class="section active">
            <h2>Product Management</h2>
            
            <div class="card">
                <h3 id="form-title">Add New Product</h3>
                <form onsubmit="handleProductSubmit(event)" class="form-grid">
                    <input type="hidden" id="p-index"> <div><label>Product Name</label><input type="text" id="p-name" required></div>
                    <div><label>Price (₹)</label><input type="number" id="p-price" required></div>
                    
                    <div><label>Tag (e.g. Best Seller)</label><input type="text" id="p-tag" required></div>
                    <div><label>Image URL</label><input type="text" id="p-image" required></div>
                    
                    <div class="full-width">
                        <label>Description</label>
                        <textarea id="p-desc" rows="3" required></textarea>
                    </div>
                    
                    <button type="submit" id="p-btn">Add Product</button>
                    <button type="button" class="btn-cancel" onclick="resetProductForm()" id="p-cancel" style="display:none;">Cancel Edit</button>
                </form>
            </div>

            <div class="card">
                <h3>Inventory</h3>
                <table>
                    <thead><tr><th>Img</th><th>Name</th><th>Tag</th><th>Price</th><th>Actions</th></tr></thead>
                    <tbody id="product-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="faqs" class="section">
            <h2>Manage FAQs</h2>
            <div class="card">
                <h3 id="faq-form-title">Add New Question</h3>
                <form onsubmit="handleFAQSubmit(event)">
                    <input type="hidden" id="f-index">
                    <div style="margin-bottom:10px;"><label>Question</label><input type="text" id="f-question" required></div>
                    <div style="margin-bottom:10px;"><label>Answer</label><textarea id="f-answer" rows="3" required></textarea></div>
                    <div style="display:flex; gap:10px;">
                        <button type="submit" id="f-btn">Save FAQ</button>
                        <button type="button" class="btn-cancel" onclick="resetFAQForm()" id="f-cancel" style="display:none;">Cancel</button>
                    </div>
                </form>
            </div>
            <div id="faq-list"></div>
        </div>

        <div id="messages" class="section">
            <h2>Customer Questions</h2>
            <div id="messages-container"></div>
        </div>

    </div>

    <script>
        // --- 1. NAVIGATION ---
        function showSection(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // --- 2. PRODUCT LOGIC (CRUD) ---
        // Default data if storage is empty
        const defaultProducts = [
            {name: "Mr. Froggy", price: 299, tag: "Best Seller", image: "https://images.unsplash.com/photo-1606293926075-69a00ce75815?ixlib=rb-4.0.3", desc: "A friendly green frog."},
            {name: "Honey Bear", price: 349, tag: "New", image: "https://images.unsplash.com/photo-1596914565751-6e3e144a991f?ixlib=rb-4.0.3", desc: "Sweet little bear."}
        ];

        function loadProducts() {
            let products = JSON.parse(localStorage.getItem('siteProducts'));
            if (!products || products.length === 0) {
                products = defaultProducts;
                localStorage.setItem('siteProducts', JSON.stringify(products));
            }
            
            const tbody = document.getElementById('product-table-body');
            tbody.innerHTML = "";
            
            products.forEach((p, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td><img src="${p.image}" class="prod-img-preview"></td>
                        <td><strong>${p.name}</strong><br><small style="color:#777">${p.desc.substring(0,30)}...</small></td>
                        <td><span style="background:#eee; padding:2px 6px; border-radius:4px; font-size:0.8rem;">${p.tag}</span></td>
                        <td>₹${p.price}</td>
                        <td class="actions">
                            <button class="btn-edit" onclick="editProduct(${index})"><i class="fas fa-edit"></i></button>
                            <button class="btn-delete" onclick="deleteProduct(${index})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        function handleProductSubmit(e) {
            e.preventDefault();
            const index = document.getElementById('p-index').value;
            const newProduct = {
                name: document.getElementById('p-name').value,
                price: document.getElementById('p-price').value,
                tag: document.getElementById('p-tag').value,
                image: document.getElementById('p-image').value,
                desc: document.getElementById('p-desc').value
            };

            let products = JSON.parse(localStorage.getItem('siteProducts')) || [];

            if (index === "") {
                // Create New
                products.push(newProduct);
                alert("Product Added!");
            } else {
                // Update Existing
                products[index] = newProduct;
                alert("Product Updated!");
            }

            localStorage.setItem('siteProducts', JSON.stringify(products));
            resetProductForm();
            loadProducts();
        }

        function editProduct(index) {
            let products = JSON.parse(localStorage.getItem('siteProducts'));
            const p = products[index];
            
            document.getElementById('p-index').value = index;
            document.getElementById('p-name').value = p.name;
            document.getElementById('p-price').value = p.price;
            document.getElementById('p-tag').value = p.tag;
            document.getElementById('p-image').value = p.image;
            document.getElementById('p-desc').value = p.desc;

            // Change button state
            document.getElementById('p-btn').innerText = "Update Product";
            document.getElementById('form-title').innerText = "Edit Product";
            document.getElementById('p-cancel').style.display = "inline-block";
            
            window.scrollTo(0,0);
        }

        function deleteProduct(index) {
            if(confirm("Delete this product?")) {
                let products = JSON.parse(localStorage.getItem('siteProducts'));
                products.splice(index, 1);
                localStorage.setItem('siteProducts', JSON.stringify(products));
                loadProducts();
            }
        }

        function resetProductForm() {
            document.querySelector('#products form').reset();
            document.getElementById('p-index').value = "";
            document.getElementById('p-btn').innerText = "Add Product";
            document.getElementById('form-title').innerText = "Add New Product";
            document.getElementById('p-cancel').style.display = "none";
        }

        // --- 3. FAQ LOGIC (REALTIME) ---
        const defaultFAQs = [
            {q: "How long does shipping take?", a: "We ship within 24 hours! Standard delivery is 3-5 days."},
            {q: "Do you take custom orders?", a: "Yes! Use the Request Custom button after logging in."}
        ];

        function loadFAQs() {
            let faqs = JSON.parse(localStorage.getItem('siteFAQs'));
            if (!faqs) {
                faqs = defaultFAQs;
                localStorage.setItem('siteFAQs', JSON.stringify(faqs));
            }

            const container = document.getElementById('faq-list');
            container.innerHTML = "";

            faqs.forEach((faq, index) => {
                container.innerHTML += `
                    <div class="faq-list-item">
                        <div class="faq-content">
                            <h4>${faq.q}</h4>
                            <p>${faq.a}</p>
                        </div>
                        <div class="actions">
                            <button class="btn-edit" onclick="editFAQ(${index})"><i class="fas fa-edit"></i></button>
                            <button class="btn-delete" onclick="deleteFAQ(${index})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                `;
            });
        }

        function handleFAQSubmit(e) {
            e.preventDefault();
            const index = document.getElementById('f-index').value;
            const newFAQ = {
                q: document.getElementById('f-question').value,
                a: document.getElementById('f-answer').value
            };

            let faqs = JSON.parse(localStorage.getItem('siteFAQs')) || [];

            if (index === "") { faqs.push(newFAQ); } 
            else { faqs[index] = newFAQ; }

            localStorage.setItem('siteFAQs', JSON.stringify(faqs));
            resetFAQForm();
            loadFAQs();
        }

        function editFAQ(index) {
            let faqs = JSON.parse(localStorage.getItem('siteFAQs'));
            document.getElementById('f-index').value = index;
            document.getElementById('f-question').value = faqs[index].q;
            document.getElementById('f-answer').value = faqs[index].a;
            
            document.getElementById('f-btn').innerText = "Update FAQ";
            document.getElementById('faq-form-title').innerText = "Edit FAQ";
            document.getElementById('f-cancel').style.display = "inline-block";
        }

        function deleteFAQ(index) {
            if(confirm("Delete this FAQ?")) {
                let faqs = JSON.parse(localStorage.getItem('siteFAQs'));
                faqs.splice(index, 1);
                localStorage.setItem('siteFAQs', JSON.stringify(faqs));
                loadFAQs();
            }
        }

        function resetFAQForm() {
            document.querySelector('#faqs form').reset();
            document.getElementById('f-index').value = "";
            document.getElementById('f-btn').innerText = "Save FAQ";
            document.getElementById('faq-form-title').innerText = "Add New Question";
            document.getElementById('f-cancel').style.display = "none";
        }

        // --- 4. MESSAGE LOGIC ---
        function loadMessages() {
            const messages = JSON.parse(localStorage.getItem('customerQuestions')) || [];
            const container = document.getElementById('messages-container');
            container.innerHTML = messages.length ? "" : "<p>No messages yet.</p>";
            
            messages.reverse().forEach((msg, index) => {
                const replyLink = `mailto:${msg.email}?subject=Re: Question regarding Knot & Cuddle&body=Hi ${msg.name},%0D%0A%0D%0AYou asked: "${msg.question}"%0D%0A%0D%0AHere is our answer:`;
                container.innerHTML += `
                    <div class="card" style="margin-bottom:1rem; border-left:5px solid var(--secondary);">
                        <p><strong>${msg.name}</strong> (${msg.email})</p>
                        <p style="margin:10px 0; font-style:italic;">"${msg.question}"</p>
                        <a href="${replyLink}" class="btn-edit" style="text-decoration:none; padding:8px 15px;">Reply via Email</a>
                        <button class="btn-delete" onclick="deleteMessage(${index})" style="margin-left:10px;">Dismiss</button>
                    </div>
                `;
            });
        }

        function deleteMessage(index) {
            let messages = JSON.parse(localStorage.getItem('customerQuestions'));
            messages.splice(messages.length - 1 - index, 1);
            localStorage.setItem('customerQuestions', JSON.stringify(messages));
            loadMessages();
        }

        // Init
        loadProducts();
        loadFAQs();
        loadMessages();

    </script>
</body>
</html>